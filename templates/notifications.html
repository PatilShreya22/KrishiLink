<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>{{ _('Notifications') }} | KrishiLink</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />

        <style>
            body {
                background-color: #f5f5f5;
                font-family: 'Segoe UI', sans-serif;
                font-size: 1rem;
                line-height: 1.5;
            }
            .card {
                border: none;
                border-radius: 15px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
            .card-body {
                padding: 40px 30px;
            }
            .page-title {
                color: #2e7d32;
                font-weight: 700;
                font-size: 2rem;
                margin-bottom: 1.5rem;
            }
            ul.notifications-list {
                list-style: none;
                padding-left: 0;
                margin-bottom: 0;
            }
            ul.notifications-list li {
                background-color: white;
                padding: 18px 22px;
                margin-bottom: 15px;
                border-radius: 10px;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-between;
                transition: background-color 0.3s ease;
                cursor: default;
            }
            ul.notifications-list li:hover {
                background-color: #e8f5e9;
            }
            ul.notifications-list li.unread {
                font-weight: 700;
                border-left: 5px solid #2e7d32;
            }
            ul.notifications-list li small {
                color: #666;
                margin-left: 10px;
                font-weight: 400;
                flex-shrink: 0;
            }
            form {
                margin: 0;
            }
            .btn-mark-read {
                background-color: #2e7d32;
                border: none;
                color: white;
                font-size: 0.85rem;
                padding: 6px 14px;
                border-radius: 5px;
                margin-left: 15px;
                cursor: pointer;
                transition: background-color 0.3s ease;
                flex-shrink: 0;
            }
            .btn-mark-read:hover {
                background-color: #256c28;
                color: white;
            }
            span.read-label {
                color: #388e3c;
                font-weight: 600;
                margin-left: 15px;
                flex-shrink: 0;
            }
            p.no-notifications {
                text-align: center;
                color: #555;
                font-style: italic;
                font-size: 1.1rem;
                margin-top: 2rem;
            }
            a.back-link {
                display: inline-block;
                color: #2e7d32;
                font-weight: 600;
                text-decoration: none;
                font-size: 1rem;
                transition: text-decoration 0.3s ease;
            }
            a.back-link:hover,
            a.back-link:focus {
                text-decoration: underline;
            }
            /* Responsive tweaks */
            @media (max-width: 576px) {
                .card-body {
                    padding: 30px 20px;
                }
                ul.notifications-list li {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }
                ul.notifications-list li small,
                .btn-mark-read,
                span.read-label {
                    margin-left: 0;
                }
                .btn-mark-read,
                span.read-label {
                    align-self: flex-end;
                }
            }
        </style>
    </head>
    <body>
        <!-- Top Bar -->
        <nav
            class="navbar navbar-expand-lg navbar-dark"
            style="background-color: #2e7d32"
        >
            <div class="container">
                <a
                    class="navbar-brand d-flex align-items-center"
                    href="{{ url_for('home') }}"
                >
                    <img
                        src="{{ url_for('static', filename='images/logo.png') }}"
                        alt="{{ _('KrishiLink Logo') }}"
                        height="70"
                        class="me-2"
                    />
                    <span class="fw-bold text-white"
                        >{{ _('KrishiLink') }}</span
                    >
                </a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarNav"
                    aria-controls="navbarNav"
                    aria-expanded="false"
                    aria-label="{{ _('Toggle navigation') }}"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div
                    class="collapse navbar-collapse justify-content-end"
                    id="navbarNav"
                >
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a
                                class="btn btn-outline-light dropdown-toggle"
                                href="#"
                                id="languageDropdown"
                                role="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false"
                                aria-label="{{ _('Select Language') }}"
                            >
                                üåê {{ _('Languages') }}
                            </a>
                            <ul
                                class="dropdown-menu dropdown-menu-end"
                                aria-labelledby="languageDropdown"
                            >
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="{{ url_for('set_language', lang_code='en') }}"
                                        >{{ _('English') }}</a
                                    >
                                </li>
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="{{ url_for('set_language', lang_code='hi') }}"
                                        >{{ _('‡§π‡§ø‡§®‡•ç‡§¶‡•Ä') }}</a
                                    >
                                </li>
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="{{ url_for('set_language', lang_code='mr') }}"
                                        >{{ _('‡§Æ‡§∞‡§æ‡§†‡•Ä') }}</a
                                    >
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Notifications -->
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div
                        class="card"
                        role="region"
                        aria-label="{{ _('Notifications list') }}"
                    >
                        <div class="card-body">
                            <h3 class="text-center page-title mb-4">
                                {{ _('Your Notifications') }}
                            </h3>

                            <div
                                class="d-flex justify-content-between align-items-center mb-4"
                            >
                                <a
                                    href="
                                {% if user_role == 'farmer' %}
                                    {{ url_for('farmer_dashboard') }}
                                {% else %}
                                    {{ url_for('buyer_dashboard') }}
                                {% endif %}
                            "
                                    class="back-link"
                                >
                                    {{ _('Back to Dashboard') }}
                                </a>

                                <form
                                    id="clearSelectedForm"
                                    action="{{ url_for('clear_selected_notifications') }}"
                                    method="post"
                                >
                                    <input
                                        type="hidden"
                                        name="selected_ids"
                                        id="selected_ids"
                                    />
                                    <button
                                        type="submit"
                                        class="btn btn-danger btn-sm"
                                    >
                                        {{ _('Clear Selected') }}
                                    </button>
                                </form>
                            </div>

                            {% if notifications %}
                            <form id="notificationsForm">
                                <div class="mb-2">
                                    <input type="checkbox" id="selectAll" />
                                    <label for="selectAll"
                                        >{{ _('Select All') }}</label
                                    >
                                </div>
                                <ul class="notifications-list">
                                    {% for notif in notifications %}
                                    <li
                                        class="{{ '' if notif.is_read else 'unread' }}"
                                    >
                                        <input
                                            type="checkbox"
                                            class="notif-checkbox me-2"
                                            value="{{ notif.id }}"
                                        />
                                        <div class="flex-grow-1">
                                            {{ notif.message }}
                                            <small
                                                >{{
                                                notif.created_at.strftime('%Y-%m-%d
                                                %H:%M') }}</small
                                            >
                                        </div>
                                        {% if not notif.is_read %}
                                        <form
                                            action="{{ url_for('mark_notification_read', notif_id=notif.id) }}"
                                            method="post"
                                            style="display: inline"
                                        >
                                            <button
                                                type="submit"
                                                class="btn-mark-read"
                                            >
                                                {{ _('Mark as read') }}
                                            </button>
                                        </form>
                                        {% else %}
                                        <span class="read-label"
                                            >{{ _('Read') }}</span
                                        >
                                        {% endif %}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </form>
                            {% else %}
                            <p class="no-notifications">
                                {{ _('You have no notifications.') }}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FOOTER -->
        <footer class="text-center text-white bg-dark py-2 mt-5">
            ¬© 2025 {{ _('KrishiLink. All Rights Reserved.') }}
        </footer>
        <!-- Bootstrap Script -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document
                .getElementById('selectAll')
                ?.addEventListener('change', function () {
                    document
                        .querySelectorAll('.notif-checkbox')
                        .forEach((cb) => (cb.checked = this.checked));
                });

            document
                .getElementById('clearSelectedForm')
                ?.addEventListener('submit', function (e) {
                    e.preventDefault();
                    let selected = Array.from(
                        document.querySelectorAll('.notif-checkbox:checked')
                    ).map((cb) => cb.value);
                    if (selected.length === 0) {
                        alert(
                            "{{ _('Please select at least one notification to clear.') }}"
                        );
                        return;
                    }
                    document.getElementById('selected_ids').value =
                        selected.join(',');
                    this.submit();
                });
        </script>
    </body>
</html>
